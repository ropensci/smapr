<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to the smapr package • smapr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to the smapr package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">smapr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/smapr-intro.html">Introduction to the smapr package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/earthlab/smapr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to the smapr package</h1>
                        <h4 class="author">Maxwell B. Joseph</h4>
            
            <h4 class="date">2018-08-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/earthlab/smapr/blob/master/vignettes/smapr-intro.Rmd"><code>vignettes/smapr-intro.Rmd</code></a></small>
      <div class="hidden name"><code>smapr-intro.Rmd</code></div>

    </div>

    
    
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(smapr)
<span class="kw">library</span>(sp)
<span class="kw">library</span>(raster)</code></pre></div>
<p>This vignette outlines a basic use scenario for smapr. We will acquire and process <a href="http://smap.jpl.nasa.gov/">NASA (Soil Moisture Active-Passive) SMAP data</a>, and generate some simple visualizations.</p>
<div id="smap-data-products" class="section level2">
<h2 class="hasAnchor">
<a href="#smap-data-products" class="anchor"></a>SMAP data products</h2>
<p>Multiple SMAP data products are provided by the NSIDC, and these products vary in the amount of processing. Currently, smapr primarily supports level 3 and level 4 data products, which represent global daily composite and global three hourly modeled data products, respectively. NSIDC provides documentation for all SMAP data products on their <a href="https://nsidc.org/data/smap/smap-data.html">website</a>, and we provide a summary of data products supported by smapr below.</p>
<table class="table">
<thead><tr class="header">
<th>Dataset id</th>
<th>Description</th>
<th>Resolution</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>SPL2SMAP_S</td>
<td>SMAP/Sentinel-1 Radiometer/Radar Soil Moisture</td>
<td>3 km</td>
</tr>
<tr class="even">
<td>SPL3FTA</td>
<td>Radar Northern Hemisphere Daily Freeze/Thaw State</td>
<td>3 km</td>
</tr>
<tr class="odd">
<td>SPL3SMA</td>
<td>Radar Global Daily Soil Moisture</td>
<td>3 km</td>
</tr>
<tr class="even">
<td>SPL3SMP</td>
<td>Radiometer Global Soil Moisture</td>
<td>36 km</td>
</tr>
<tr class="odd">
<td>SPL3SMAP</td>
<td>Radar/Radiometer Global Soil Moisture</td>
<td>9 km</td>
</tr>
<tr class="even">
<td>SPL4SMAU</td>
<td>Surface/Rootzone Soil Moisture Analysis Update</td>
<td>9 km</td>
</tr>
<tr class="odd">
<td>SPL4SMGP</td>
<td>Surface/Rootzone Soil Moisture Geophysical Data</td>
<td>9 km</td>
</tr>
<tr class="even">
<td>SPL4SMLM</td>
<td>Surface/Rootzone Soil Moisture Land Model Constants</td>
<td>9 km</td>
</tr>
<tr class="odd">
<td>SPL4CMDL</td>
<td>Carbon Net Ecosystem Exchange</td>
<td>9 km</td>
</tr>
</tbody>
</table>
<p>This vignette uses the level 4 <a href="https://nsidc.org/data/SPL4SMAU">SPL4SMAU</a> (Surface/Rootzone Soil Moisture Analysis Update) data product.</p>
</div>
<div id="finding-data" class="section level2">
<h2 class="hasAnchor">
<a href="#finding-data" class="anchor"></a>Finding data</h2>
<p>To find out which SMAP data are available, we’ll use the <code>find_smap</code> function, which takes a data set ID, date(s) to search, and a dataset version. The SPL4SMAU data product is on version 3 (see <a href="https://nsidc.org/data/SPL4SMAU" class="uri">https://nsidc.org/data/SPL4SMAU</a>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">available_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/find_smap.html">find_smap</a></span>(<span class="dt">id =</span> <span class="st">'SPL4SMAU'</span>, <span class="dt">dates =</span> <span class="st">'2018-06-01'</span>, <span class="dt">version =</span> <span class="dv">3</span>)</code></pre></div>
<p>This returns a data frame, where every row is one data file that is available on NASA’s servers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(available_data)</code></pre></div>
</div>
<div id="downloading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-data" class="anchor"></a>Downloading data</h2>
<p>To download the data, we can use <code>download_smap</code>. Note that this may take a while, depending on the number of files being downloaded, and the speed of your internet connection. Because we’re downloading multiple files, we will use the <code>verbose = FALSE</code> argument to avoid printing excessive output to the console.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">local_files &lt;-<span class="st"> </span><span class="kw"><a href="../reference/download_smap.html">download_smap</a></span>(available_data, <span class="dt">overwrite =</span> <span class="ot">FALSE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>Each file corresponds to different times as indicated by the file names:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">local_files<span class="op">$</span>name[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</code></pre></div>
</div>
<div id="exploring-data" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-data" class="anchor"></a>Exploring data</h2>
<p>Each file that we downloaded is an HDF5 file with multiple datasets bundled together. To list all of the data in a file we can use <code>list_smap</code>. By default, if we give <code>list_smap</code> a data frame of local files, it will return a list of data frames. Because all of these data files are of the same data product, using <code>list_smap</code> on one file (e.g., the first) will tell us what’s available in all of the files:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/list_smap.html">list_smap</a></span>(local_files[<span class="dv">1</span>, ])</code></pre></div>
<p>To dig deeper, we can use the <code>all</code> argument to <code>list_smap</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/list_smap.html">list_smap</a></span>(local_files[<span class="dv">1</span>, ], <span class="dt">all =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>Looking at this output, we can conclude that the file contains multiple arrays (notice the <code>dim</code> column). These arrays correspond to things like estimated root zone soil moisture (<code>/Analysis_Data/sm_rootzone_analysis</code>), estimated surface soil moisture (<code>/Analysis_Data/sm_surface_analysis</code>), and estimated surface temperature (<code>/Analysis_Data/surface_temp_analysis</code>). See <a href="https://nsidc.org/data/smap/spl4sm/data-fields#sm_surface_analysis" class="uri">https://nsidc.org/data/smap/spl4sm/data-fields#sm_surface_analysis</a> for more detailed information on what these datasets represent and how they were generated.</p>
</div>
<div id="extracting-data" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-data" class="anchor"></a>Extracting data</h2>
<p>The datasets that we are interested in are spatial grids. The <code>smapr</code> package can extract these data into <code>raster</code> objects with the <code>extract_smap</code> function, which takes a dataset name as an argument. These names are paths that can be generated from the output of <code>list_smap</code>. For example, if we want to get rootzone soil moisture, we can see a dataset with name <code>sm_rootzone_analysis</code> in group <code>/Analysis_Data</code>, so that the path to the dataset is <code>/Analysis_Data/sm_rootzone_analysis</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sm_raster &lt;-<span class="st"> </span><span class="kw"><a href="../reference/extract_smap.html">extract_smap</a></span>(local_files, <span class="st">'/Analysis_Data/sm_rootzone_analysis'</span>)</code></pre></div>
<p>This will extract all of the data in the data frame <code>local_files</code>, generating a RasterBrick with one layer per file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sm_raster</code></pre></div>
<p>We can visualize each layer in our RasterBrick:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(sm_raster)</code></pre></div>
</div>
<div id="common-downstream-operations" class="section level2">
<h2 class="hasAnchor">
<a href="#common-downstream-operations" class="anchor"></a>Common downstream operations</h2>
<div id="study-region-cropping-and-masking" class="section level3">
<h3 class="hasAnchor">
<a href="#study-region-cropping-and-masking" class="anchor"></a>Study region cropping and masking</h3>
<p>If you want to crop the data to a study region, you can use the <code><a href="http://www.rdocumentation.org/packages/raster/topics/crop">raster::crop</a></code> function. Let’s illustrate by focusing on the state of Colorado, which is approximately rectangular, so that we can define an <code>extent</code> object using latitude and longitude values that roughly correspond to the state boundaries. The <code><a href="http://www.rdocumentation.org/packages/raster/topics/extent">raster::extent()</a></code> function can be used with any <code>Spatial*</code> or <code>Raster*</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">co_extent &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/extent">extent</a></span>(<span class="kw">c</span>(<span class="op">-</span><span class="dv">109</span>, <span class="dv">-102</span>, <span class="dv">37</span>, <span class="dv">41</span>))
co_extent &lt;-<span class="st"> </span><span class="kw">as</span>(co_extent, <span class="st">"SpatialPolygons"</span>)
sp<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/is.projected">proj4string</a></span>(co_extent) &lt;-<span class="st"> "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"</span>
co_extent</code></pre></div>
<p>Now that we have a SpatialPolygons object, we can use this to crop the soil moisture raster to our study region. First, we need to ensure that the projections are the same:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">proj_co_extent &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/spTransform">spTransform</a></span>(co_extent, <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/projection">crs</a></span>(sm_raster))</code></pre></div>
<p>Then, we could crop the soil moisture data to our polygon, which will make the extents match.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">co_soil_moisture &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/crop">crop</a></span>(sm_raster, proj_co_extent)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(co_soil_moisture)</code></pre></div>
<p>We might also have a polygon to use as a mask. For example, to mask out our Colorado polygon, we could do the following (operating on the first layer of the soil moisture raster for simplicity):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/mask">mask</a></span>(sm_raster[[<span class="dv">1</span>]], proj_co_extent))</code></pre></div>
<p>Notice that masking does not crop the raster, it simply sets all values outside of the polygon to NA. In some cases, an inverse mask is useful, where values inside the polygon are set to NA:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/mask">mask</a></span>(sm_raster[[<span class="dv">1</span>]], proj_co_extent, <span class="dt">inverse =</span> <span class="ot">TRUE</span>))</code></pre></div>
</div>
<div id="computing-summary-statistics-over-layers" class="section level3">
<h3 class="hasAnchor">
<a href="#computing-summary-statistics-over-layers" class="anchor"></a>Computing summary statistics over layers</h3>
<p>We may want to average soil moisture values across layers of a raster brick. This can be done with the <code>raster::cal()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_sm &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/calc">calc</a></span>(sm_raster, <span class="dt">fun =</span> mean)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(mean_sm, <span class="dt">main =</span> <span class="st">'Mean soil moisture'</span>)</code></pre></div>
</div>
<div id="comparing-surface-and-soil-moisture" class="section level3">
<h3 class="hasAnchor">
<a href="#comparing-surface-and-soil-moisture" class="anchor"></a>Comparing surface and soil moisture</h3>
<p>Our SPL4SMAU data have estimated surface and rootzone soil moisture layers. If we want to compare these values, we can load the surface soil moisture data, compute the mean value over layers as we did for the rootzone soil moisture raster, and generate a scatterplot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">surface_raster &lt;-<span class="st"> </span><span class="kw"><a href="../reference/extract_smap.html">extract_smap</a></span>(local_files, 
                               <span class="dt">name =</span> <span class="st">'/Analysis_Data/sm_surface_analysis'</span>)

<span class="co"># compute mean</span>
mean_surface_sm &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/calc">calc</a></span>(surface_raster, <span class="dt">fun =</span> mean)

<span class="co"># compare values</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/getValues">values</a></span>(mean_sm), <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/getValues">values</a></span>(mean_surface_sm), <span class="dt">col =</span> <span class="st">'dodgerblue'</span>, <span class="dt">cex =</span> <span class="fl">.1</span>, 
     <span class="dt">xlab =</span> <span class="st">'Rootzone soil moisture'</span>, <span class="dt">ylab =</span> <span class="st">'Surface soil moisture'</span>, <span class="dt">bty =</span> <span class="st">'n'</span>)
<span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">lty =</span> <span class="dv">2</span>)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#smap-data-products">SMAP data products</a></li>
      <li><a href="#finding-data">Finding data</a></li>
      <li><a href="#downloading-data">Downloading data</a></li>
      <li><a href="#exploring-data">Exploring data</a></li>
      <li><a href="#extracting-data">Extracting data</a></li>
      <li><a href="#common-downstream-operations">Common downstream operations</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Maxwell Joseph, Matthew Oakley, Zachary Schira.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
