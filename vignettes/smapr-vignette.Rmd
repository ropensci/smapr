---
title: "An introduction to smapr"
author: "Maxwell B. Joseph"
date: "`r Sys.Date()`"
output:
      rmarkdown::html_vignette:
        fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

In 2015 NASA launched the Soil Moisture Active Passive (SMAP) instrument, which measures global surface soil moisture and soil freeze-thaw conditions from space. 
The data are publicly available in HDF5 format via an FTP server hosted by the National Snow and Ice Data Center Distributed Active Archive Center (NSIDC DAAC). 
The smapr package provides a suite of functions for programmatic discovery, download, exploration, and extraction of SMAP data. 

Multiple SMAP data products are provided by the NSIDC DAAC, and these products vary in the amount of processing. 
Currently, smapr supports the more processed level 3 and level 4 data products, which represent global daily composite and global three hourly modeled data products, respectively. 
NSIDC provides documentation for all SMAP data products on their [website](https://nsidc.org/data/smap/smap-data.html), and we provide a summary of level 3 and level 4 products below. 

### Supported SMAP data products

| Dataset id | Description                                         | Resolution |
|------------|-----------------------------------------------------|------------|
| SPL3FTA    | Radar Northern Hemisphere Daily Freeze/Thaw State   | 3 km       |
| SPL3SMA    | Radar Global Daily Soil Moisture                    | 3 km       |
| SPL3SMP    | Radiometer Global Soil Moisture                     | 36 km      |
| SPL3SMAP   | Radar/Radiometer Global Soil Moisture               | 9 km       |
| SPL4SMAU   | Surface/Rootzone Soil Moisture Analysis Update      | 9 km       | 
| SPL4SMGP   | Surface/Rootzone Soil Moisture Geophysical Data     | 9 km       |
| SPL4SMLM   | Surface/Rootzone Soil Moisture Land Model Constants | 9 km       |
| SPL4CMDL   | Carbon Net Ecosystem Exchange                       | 9 km       |

Finding SMAP data


```{r}
library(smapr)
library(rasterVis)
available_data <- find_smap(id = "SPL3SMAP", date = "2015.05.25", version = 3)
available_data
```

Downloading and listing SMAP data


```{r}
downloads <- download_smap(available_data)
downloads

list_smap(downloads, all = TRUE)
```

Rasterizing SMAP data


```{r, fig.align='center', fig.width=8, fig.height=7}
sm_raster <- extract_smap(downloads, "Soil_Moisture_Retrieval_Data/soil_moisture")
plot(sm_raster, main = "Level 3 soil moisture: May 25, 2015")
```

Example usage utilizing level 4 products


```{r}
available_data <- find_smap(id = "SPL4SMGP", date = "2015.05.25", version = 2)
available_data
```

```{r}
downloads <- download_smap(available_data[1, ])
downloads

list_smap(downloads, all = TRUE)
```

```{r, fig.align='center', fig.width=8, fig.height=7}
sm_raster <- extract_smap(downloads, "Geophysical_Data/sm_surface")
plot(sm_raster, main = "Level 4 soil moisture: May 25, 2015")
```

Example usage utilizing level 3 products

```{r}
available_data <- find_smap(id = "SPL3FTA", date = "2015.04.14", version = 3)
available_data
```

```{r}
downloads <- download_smap(available_data)
downloads

list_smap(downloads, all = TRUE)
```

```{r, fig.align='center', fig.width=8, fig.height=7}
sm_raster <- extract_smap(downloads, "Freeze_Thaw_Retrieval_Data/freeze_thaw")
levelplot(sm_raster, main = "Level 3 freeze thaw: April 13, 2015", 
          names.attr = c("AM", "PM"))
```
